<!DOCTYPE html>
<html dir="rtl">
<head>
    <title>Ø¥ØµÙ„Ø§Ø­ Ø§ØªØµØ§Ù„ ORBITX</title>
    <style>
        body { background: #0a0a2a; color: white; font-family: Arial; padding: 20px; }
        .container { max-width: 600px; margin: 50px auto; background: #1a1a4a; padding: 30px; border-radius: 15px; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #0a0a2a; border: 1px solid #8a2be2; color: white; border-radius: 8px; }
        button { background: #8a2be2; color: white; padding: 15px 30px; border: none; border-radius: 8px; cursor: pointer; margin: 10px; }
        .success { color: #00ff88; }
        .error { color: #ff5555; }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ”§ Ø¥ØµÙ„Ø§Ø­ Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
        
        <div id="step1">
            <h3>1. Ø®Ø° Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù…Ù† Supabase</h3>
            <ol>
                <li>Ø§Ø¯Ø®Ù„ <a href="https://supabase.com" target="_blank">Supabase</a></li>
                <li>Ø§ÙØªØ­ Ù…Ø´Ø±ÙˆØ¹Ùƒ</li>
                <li>âš™ï¸ Settings â†’ API</li>
                <li>Ø§Ù†Ø³Ø® <strong>Project URL</strong></li>
                <li>Ø§Ù†Ø³Ø® <strong>anon public</strong></li>
            </ol>
            <button onclick="showStep2()">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
        </div>
        
        <div id="step2" style="display:none;">
            <h3>2. Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù‡Ù†Ø§:</h3>
            <input type="text" id="supabaseUrl" placeholder="https://abc123.supabase.co">
            <input type="text" id="supabaseKey" placeholder="eyJhbGciOiJIUzI1NiIs...">
            <button onclick="testConnection()">ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
            <p id="testResult"></p>
            
            <div id="step3" style="display:none; margin-top:20px;">
                <h3>3. Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­! âœ…</h3>
                <button onclick="saveAndRedirect()" style="background:#00c6ff;">
                    ğŸ’¾ Ø­ÙØ¸ ÙˆØ§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù…ÙˆÙ‚Ø¹ ORBITX
                </button>
            </div>
        </div>
    </div>

    <script>
        function showStep2() {
            document.getElementById('step1').style.display = 'none';
            document.getElementById('step2').style.display = 'block';
        }
        
        async function testConnection() {
            const url = document.getElementById('supabaseUrl').value;
            const key = document.getElementById('supabaseKey').value;
            
            if (!url || !key) {
                document.getElementById('testResult').innerHTML = '<span class="error">âŒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø£ÙˆÙ„Ø§Ù‹</span>';
                return;
            }
            
            document.getElementById('testResult').innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
            
            try {
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
                const response = await fetch(`${url}/rest/v1/users?limit=1`, {
                    headers: {
                        'apikey': key,
                        'Authorization': `Bearer ${key}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('testResult').innerHTML = 
                        `<span class="success">âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­!</span><br>
                         <small>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data.length} Ù…Ø³ØªØ®Ø¯Ù…</small>`;
                    
                    document.getElementById('step3').style.display = 'block';
                    
                    // Ø­ÙØ¸ Ø§Ù„Ù…ÙØ§ØªÙŠØ­
                    localStorage.setItem('orbitx_fixed_url', url);
                    localStorage.setItem('orbitx_fixed_key', key);
                    
                } else {
                    document.getElementById('testResult').innerHTML = 
                        `<span class="error">âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ (${response.status})</span>`;
                }
            } catch (error) {
                document.getElementById('testResult').innerHTML = 
                    `<span class="error">âŒ Ø®Ø·Ø£: ${error.message}</span>`;
            }
        }
        
        function saveAndRedirect() {
            const url = document.getElementById('supabaseUrl').value;
            const key = document.getElementById('supabaseKey').value;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù config.js ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            const configContent = `
// config.js - ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
const SUPABASE_CONFIG = {
    URL: "${url}",
    ANON_KEY: "${key}",
    ADMIN_EMAIL: "abdalrhmanmaaith1@gmail.com"
};
window.ORBITX_CONFIG = SUPABASE_CONFIG;
console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase');
`;
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
            const blob = new Blob([configContent], { type: 'text/javascript' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'config.js';
            link.click();
            
            alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙØ§ØªÙŠØ­! Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ù„Ù…ÙˆÙ‚Ø¹ ORBITX');
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 2000);
        }
        
        // ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠÙ‡ Ù…ÙØ§ØªÙŠØ­ Ù…Ø­ÙÙˆØ¸Ø©
        window.onload = function() {
            const savedUrl = localStorage.getItem('orbitx_fixed_url');
            const savedKey = localStorage.getItem('orbitx_fixed_key');
            
            if (savedUrl && savedKey) {
                document.getElementById('supabaseUrl').value = savedUrl;
                document.getElementById('supabaseKey').value = savedKey;
                showStep2();
            }
        };
    </script>
</body>
</html>
